# netology_12-8

# Домашнее задание к занятию «Резервное копирование баз данных»

## Задание 1. Резервное копирование
## Кейс

Финансовая компания решила увеличить надёжность работы баз данных и их резервного копирования.  
Необходимо описать, какие варианты резервного копирования подходят в случаях:
1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.
1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.
1.3.* Возможен ли кейс, когда при поломке базы происходило моментальное переключение на работающую или починенную базу данных.  
Приведите ответ в свободной форме.

## Решение 1.

1.1. Необходимо восстанавливать данные в полном объёме за предыдущий день.  
В этом случае можно использовать такие варианты резервного копирования:  
- Полное резервное копирование (Full backup). 
- Полное резервное копирование с дифференциальным бэкапом (differential backup).
 
Дифференциальный бэкап более надёжен по сравнению с инкрементным бэкапом.  
Интенсивность резервного копирования и дифференциального бэкапа зависит от требований по сохранности БД и возможностей по хранению таких объёмов данных.

1.2. Необходимо восстанавливать данные за час до предполагаемой поломки.  
- Полное резервное копирование каждый день с дифференциальным бэкапом каждый час. Этот вариант более надёжный, но использует больше места для хранения.
- Полное резервное копирование каждый день с инкрементным бэкапом каждый час. Этот вариант менее надежный, но использует меньше места для хранения.

## Задание 2. PostgreSQL

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).
2.1.* Возможно ли автоматизировать этот процесс? Если да, то как?  
Приведите ответ в свободной форме.

## Решение 2.

2.1. С помощью официальной документации приведите пример команды резервирования данных и восстановления БД (pgdump/pgrestore).

Команда резервирования данных:
```
pg_dump mydb > db.sql
Если нужен другой пользовательский формат, то указываем параметр -Fc:
pg_dump -Fc mydb > db.dump
Если БД принадлежит другому пользователю, то указываем параметр -U username:
pg_dump -U username mydb > db.sql
```
![Ссылка на документацию PostgreSQL, pg_dump](https://www.postgresql.org/docs/current/app-pgdump.html)

Команда восстановления БД:
```
pg_restore -d newdb db.sql
```
![Ссылка на документацию PostgreSQL, pg_restore](https://www.postgresql.org/docs/current/app-pgrestore.html)

## Задание 3. MySQL

3.1. С помощью официальной документации приведите пример команды инкрементного резервного копирования базы данных MySQL.
3.1.* В каких случаях использование реплики будет давать преимущество по сравнению с обычным резервным копированием?  
Приведите ответ в свободной форме.

## Решение 3.

Инкрементное резервное копирование использует полную копию как начальную точку, поэтому сначала нужно сделать полную резервную копию. Затем инкрементное резервное копирование:
```
mysqlbackup --defaults-file=/home/dbadmin/my.cnf \
  --incremental --incremental-base=history:last_backup \
  --backup-dir=/home/dbadmin/temp_dir \
  --backup-image=incremental_image1.bi \
   backup-to-image
```
В данном примере используется опция --incremental-base=history:last_backup, которая извлекает LSN последней успешной полной или частичной резервной копии (не TTS) из mysql.backup_history таблицы и выполняет инкрементное резервное копирование на его основе.
![Ссылка на документацию MySQL](https://dev.mysql.com/doc/mysql-enterprise-backup/8.4/en/mysqlbackup.incremental.html#meb-incremental-considerations)
